<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biodata</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    /* üé® TEMA: CREAMY BEIGE & MUTED BRONZE + BORDER SHADOW */
    :root {
      --primary-color: #f5f5dc; /* Creamy Beige - Krem Pucat */
      --secondary-color: #e6e6d1; /* Off-White/Hampir Putih */
      --accent-color: #a67c52; /* Muted Bronze - Perunggu Diredam */
      --background-light: #fdfae7; /* Dasar Paling Terang */
      --card-bg: rgba(250, 250, 240, 0.9); 
      --text-dark: #3e3834; /* Deep Taupe/Arang Lembut (Teks Kontras) */
      --input-bg: #ffffff; /* Latar input Putih Bersih */
      
      /* Variabel Shadow Khusus Border Shadow/Glow */
      --border-glow-soft: 0 0 10px rgba(166, 124, 82, 0.4); /* Bayangan Perunggu Halus */
      --border-glow-focus: 0 0 15px rgba(166, 124, 82, 0.7); /* Bayangan Perunggu Lebih Jelas */
      --general-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); /* Shadow umum untuk kesan timbul */
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0; padding: 0;
      min-height: 100vh;
      display: flex; justify-content: center; align-items: center;
      color: var(--text-dark);
      background: linear-gradient(135deg, var(--background-light) 0%, var(--secondary-color) 100%); 
      overflow-x: hidden;
    }

    .container {
      position: relative;
      z-index: 1;
      background: var(--card-bg);
      backdrop-filter: blur(5px); 
      padding: 40px;
      border-radius: 25px; 
      border: 1px solid var(--secondary-color);
      /* Border Shadow pada Container Utama */
      box-shadow: var(--border-glow-soft), var(--general-shadow);
      width: 95%; max-width: 850px;
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }
    
    .container:hover {
        /* Border Shadow Lebih Jelas saat Hover */
        box-shadow: var(--border-glow-focus), 0 8px 20px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
    }

    h1 {
      text-align: center;
      color: var(--accent-color); 
      font-weight: 700;
      font-size: 2.4em;
      margin-bottom: 30px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1); 
    }

    fieldset {
      border: 1px solid var(--accent-color); /* Border Perunggu */
      border-radius: 15px; 
      padding: 25px;
      margin-bottom: 25px;
      background: var(--primary-color);
      /* Border Shadow pada Fieldset */
      box-shadow: var(--border-glow-soft);
    }

    legend {
      font-weight: 600;
      color: var(--accent-color); 
      font-size: 1.4em;
      padding: 0 10px;
      background: var(--primary-color); 
      border-radius: 5px;
      border: 1px solid var(--accent-color);
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.15);
    }

    label { 
      display: block; 
      margin-top: 15px; 
      font-weight: 500; 
      color: var(--text-dark); 
    }

    input, textarea, select {
      width: 100%; padding: 12px;
      border: 1px solid #ccc; /* Border abu-abu netral */
      border-radius: 8px;
      margin-top: 5px;
      color: var(--text-dark);
      font-size: 15px;
      transition: all 0.3s ease;
      background: var(--input-bg);
      /* Border Shadow pada Input (sangat halus) */
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      /* Border Shadow Fokus yang Jelas */
      border-color: var(--accent-color);
      box-shadow: 0 0 8px rgba(166, 124, 82, 0.8); 
    }

    textarea { resize: vertical; }

    .row { display: flex; gap: 20px; flex-wrap: wrap; }
    .col { flex: 1; }

    button {
      width: 100%; padding: 15px;
      border: none; border-radius: 10px;
      font-size: 17px; font-weight: 700;
      margin-top: 15px; cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--background-light); 
    }

    .primary-btn {
      background: linear-gradient(90deg, #b7926e, var(--accent-color)); 
      /* Shadow Timbul Standar */
      box-shadow: 0 4px 10px rgba(166, 124, 82, 0.4); 
    }
    .primary-btn:hover { 
      transform: translateY(-2px); 
      background: linear-gradient(90deg, var(--accent-color), #b7926e); 
      box-shadow: 0 6px 15px rgba(166, 124, 82, 0.6);
    }

    .secondary-btn {
      background: linear-gradient(90deg, var(--accent-color), #b7926e); 
      box-shadow: 0 4px 10px rgba(166, 124, 82, 0.4); 
    }
    .secondary-btn:hover { 
      transform: translateY(-2px); 
      background: linear-gradient(90deg, #b7926e, var(--accent-color)); 
      box-shadow: 0 6px 15px rgba(166, 124, 82, 0.6);
    }


    .back-btn {
      background: var(--text-dark); 
      color: var(--primary-color); 
      margin-top: 20px;
      font-weight: 800;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    .back-btn:hover { transform: scale(1.02); background: #5d5754; } 

    #response-message {
      text-align: center;
      font-weight: bold;
      margin-top: 15px;
      font-size: 1.1em;
      color: var(--accent-color);
    }

    /* üëá PERBAIKAN CSS UNTUK RESPONSIVITAS TABEL */
    .table-responsive {
      overflow-x: auto; /* Memungkinkan horizontal scroll jika isi tabel melebihi lebar kontainer */
      margin-top: 25px;
      border-radius: 15px;
      box-shadow: var(--general-shadow);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      /* min-width yang lebih besar dari lebar mobile agar scroll aktif */
      min-width: 700px; 
      overflow: hidden;
      box-shadow: none; /* Shadow dipindah ke .table-responsive */
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1); 
      text-align: left;
      color: var(--text-dark);
      background-color: var(--primary-color); 
      /* Penting untuk memastikan kolom tidak terlalu menyempit */
      min-width: 120px; 
      white-space: nowrap; /* Mencegah teks terpotong baris */
    }

    th {
      /* Header Table Muted Bronze */
      background: linear-gradient(90deg, #b7926e, var(--accent-color));
      color: var(--background-light); 
      text-transform: uppercase;
      font-weight: 700;
    }

    tr:nth-child(even) { background: #f0f0e0; } /* Baris Krem/Kuning langsat */
    tr:hover { background: #e0d0c0; } /* Hover Coklat Muda */
    /* üëÜ AKHIR PERBAIKAN CSS RESPONSIVITAS TABEL */


    img.preview {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 50%; 
      border: 2px solid var(--accent-color);
      box-shadow: 0 0 8px rgba(166, 124, 82, 0.5); /* Border Shadow pada Foto */
    }

    #searchInput {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      color: var(--text-dark);
      background: var(--input-bg);
      border: 1px solid #ccc;
      /* Border Shadow pada Search Input saat fokus */
      transition: box-shadow 0.3s ease;
    }
    #searchInput:focus {
        box-shadow: 0 0 8px rgba(166, 124, 82, 0.8);
        border-color: var(--accent-color);
    }

    @media (max-width: 600px) {
      .row { flex-direction: column; }
      .container { padding: 25px; }
      h1 { font-size: 1.8em; }
    }
  </style>
</head>

<body>
  <div class="container">

    <h1>FORMULIR PENDAFTARAN</h1>

    <form id="biodataForm">

      <fieldset>
        <legend>üë§ Informasi Pribadi</legend>

        <label>Nama Lengkap:</label>
        <input type="text" name="Nama Lengkap" required>

        <label>Jenis Kelamin:</label>
        <select name="Jenis Kelamin" required>
          <option value="">Pilih</option>
          <option>Laki-laki</option>
          <option>Perempuan</option>
        </select>

        <div class="row">
          <div class="col">
            <label>Tempat Lahir:</label>
            <input type="text" name="Tempat Lahir" required>
          </div>
          <div class="col">
            <label>Tanggal Lahir:</label>
            <input type="date" name="Tanggal Lahir" required>
          </div>
        </div>

        <label>Alamat:</label>
        <textarea name="Alamat" rows="3" required></textarea>

        <div class="row">
          <div class="col">
            <label>Nomor Telepon:</label>
            <input type="tel" name="Nomor Telepon" required>
          </div>
          <div class="col">
            <label>Email:</label>
            <input type="email" name="Email" required>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>Agama:</label>
            <select name="Agama" required>
              <option value="">Pilih</option>
              <option>Islam</option>
              <option>Kristen</option>
              <option>Katolik</option>
              <option>Hindu</option>
              <option>Buddha</option>
              <option>Konghucu</option>
            </select>
          </div>

          <div class="col">
            <label>Status:</label>
            <select name="Status Perkawinan" required>
              <option value="">Pilih</option>
              <option>Belum Menikah</option>
              <option>Menikah</option>
              <option>Cerai</option>
            </select>
          </div>
        </div>

        <label>Kewarganegaraan:</label>
        <input type="text" name="Kewarganegaraan" value="Indonesia" required>
      </fieldset>

      <fieldset>
        <legend>üéì Pendidikan & Karir</legend>

        <label>Pendidikan Terakhir:</label>
        <input type="text" name="Pendidikan Terakhir" required>

        <label>Keahlian (Skill):</label>
        <textarea name="Keahlian (Skill)" rows="2"></textarea>

        <label>Pengalaman Kerja:</label>
        <textarea name="Pengalaman Kerja" rows="3"></textarea>

        <label>Biografi Singkat:</label>
        <textarea name="Biografi" rows="4"></textarea>
      </fieldset>

      <fieldset>
        <legend>üñºÔ∏è Finalisasi Data</legend>

        <label>Unggah Foto:</label>
        <input type="file" id="foto" name="Foto" accept="image/*" onchange="encodeImageFileAsURL(this)">

        <label>
          <input type="checkbox" name="Setuju" required>
          Saya menyatakan data di atas benar.
        </label>
      </fieldset>

      <button type="submit" class="primary-btn"> KIRIM DATA</button>
      <button type="button" class="secondary-btn" onclick="tampilkanRekap()">üìä LIHAT REKAP</button>

      <p id="response-message"></p>
    </form>

    <div id="rekapContainer" style="display:none;">
      <h2 style="text-align:center;color:var(--accent-color)">üìã Rekap Data Biodata</h2>

      <input type="text" id="searchInput" placeholder="üîç Cari nama..." 
             onkeyup="cariData()" 
             style="width:100%;padding:10px;border-radius:8px;background:var(--input-bg);color:var(--text-dark);border:1px solid #ccc;">

      <button class="back-btn" onclick="kembaliKeForm()">‚¨ÖÔ∏è KEMBALI</button>
      
      <div class="table-responsive">
        <table id="rekapTable">
          <thead><tr id="headerRow"></tr></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
      </div>

  </div>


  <script>
    // GANTI DENGAN URL GOOGLE APPS SCRIPT ANDA
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbypKY9_27nx7RE_NbN6ZDl0QTV_g0N05qNhgbXQMdJ7r7deD0R2aYRbdnYvG_dHe8i1/exec";
    let dataRekap = [];

    function encodeImageFileAsURL(el) {
      const file = el.files[0];
      const reader = new FileReader();
      reader.onloadend = () => el.setAttribute('data-base64', reader.result);
      if (file) reader.readAsDataURL(file);
    }

    const form = document.getElementById('biodataForm');
    const responseMessage = document.getElementById('response-message');

    form.addEventListener('submit', e => {
      e.preventDefault();
      responseMessage.textContent = '‚è≥ Mengirim data...';
      responseMessage.style.color = '#a67c52'; // Warna Perunggu

      const formData = new FormData(form);
      const data = {};

      formData.forEach((v, k) => {
        if (k !== 'Foto') data[k] = v;
      });

      // Ambil Base64 dari atribut data-base64
      data['Foto'] = document.getElementById('foto').getAttribute('data-base64') || '';
      data['Setuju'] = formData.get('Setuju') ? 'Ya' : 'Tidak'; 

      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(data)
      })
      .then(res => {
        if (res.ok) { 
            responseMessage.textContent = '‚úÖ Data berhasil dikirim dan tersimpan.';
            responseMessage.style.color = '#4caf50'; 
            form.reset();
        } else {
            responseMessage.textContent = '‚ùå Gagal mengirim data. Coba lagi.';
            responseMessage.style.color = '#f44336'; 
        }
      })
      .catch(err => {
        console.error("Fetch error:", err);
        responseMessage.textContent = '‚ùå Terjadi masalah koneksi atau server.';
        responseMessage.style.color = '#f44336'; 
      });
    });

    async function tampilkanRekap() {
      form.style.display = "none";
      document.getElementById("rekapContainer").style.display = "block";
      await loadData();
    }

    function kembaliKeForm() {
      document.getElementById("rekapContainer").style.display = "none";
      form.style.display = "block";
    }

    async function loadData() {
      const tableBody = document.getElementById("tableBody");
      const headerRow = document.getElementById("headerRow");

      tableBody.innerHTML = `<tr><td colspan="100">‚è≥ Memuat data...</td></tr>`;

      try {
        const res = await fetch(SCRIPT_URL + "?action=read");
        const data = await res.json();

        if (!data || data.error) {
           tableBody.innerHTML = `<tr><td colspan="100">üö® Gagal memuat data. Periksa Apps Script Anda.</td></tr>`;
           return;
        }

        if (!data.length) {
          tableBody.innerHTML = `<tr><td colspan="100">Belum ada data.</td></tr>`;
          return;
        }

        dataRekap = data;

        headerRow.innerHTML = "";
        // Pastikan header hanya diambil dari keys data pertama
        Object.keys(data[0]).forEach(k => {
          const th = document.createElement("th");
          th.textContent = k.toUpperCase();
          headerRow.appendChild(th);
        });

        renderTable(dataRekap);

      } catch (err) {
        tableBody.innerHTML = `<tr><td colspan="100">üö® Gagal memuat data</td></tr>`;
      }
    }

    function renderTable(data) {
      const tableBody = document.getElementById("tableBody");
      tableBody.innerHTML = "";
      
      const headers = Array.from(document.getElementById("headerRow").children).map(th => th.textContent);

      data.forEach((row, i) => {
        const tr = document.createElement("tr");

        // Pastikan urutan data sesuai dengan urutan header
        headers.forEach((headerText) => {
          // Cari key yang sesuai (case-insensitive)
          const k = Object.keys(row).find(key => key.toUpperCase() === headerText);
          const v = row[k];
          
          const td = document.createElement("td");

          if (k && k.toLowerCase() === "foto" && v && v.startsWith('http')) {
            // Asumsi Apps Script mengembalikan URL publik foto
            td.innerHTML = `<img src="${v}" class="preview">`;
          } else if (v) {
            td.textContent = v;
          } else {
            td.textContent = ''; // Handle nilai null/undefined
          }

          tr.appendChild(td);
        });

        tableBody.appendChild(tr);
      });
    }

    function cariData() {
      const q = document.getElementById("searchInput").value.toLowerCase();
      const filtered = dataRekap.filter(r =>
        // Cari di semua nilai properti pada objek data
        Object.values(r).some(v => v !== null && v !== undefined && String(v).toLowerCase().includes(q))
      );
      renderTable(filtered);
    }
  </script>
</body>
</html>
